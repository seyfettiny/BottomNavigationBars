import 'dart:convert';
import 'dart:typed_data';
import 'dart:ui';

import 'package:umbra_flutter/umbra_flutter.dart';

/// {@template blob}
/// A Flutter Widget for the `blob` shader.
/// {@endtemplate}
class Blob extends UmbraWidget {
  /// {@macro blob}
  const Blob({
    super.key,
    super.blendMode = BlendMode.src,
    super.child,
    super.errorBuilder,
    super.compilingBuilder,
    required double scale,
    required Vector2 uResolution,
    required Vector2 metaball1,
    required Vector2 metaball2,
    required Vector2 metaball3,
    required Vector2 metaball4,
    required Vector2 metaball5,
  })  : _scale = scale,
        _uResolution = uResolution,
        _metaball1 = metaball1,
        _metaball2 = metaball2,
        _metaball3 = metaball3,
        _metaball4 = metaball4,
        _metaball5 = metaball5,
        super();

  static Future<FragmentProgram>? _cachedProgram;

  final double _scale;

  final Vector2 _uResolution;

  final Vector2 _metaball1;

  final Vector2 _metaball2;

  final Vector2 _metaball3;

  final Vector2 _metaball4;

  final Vector2 _metaball5;

  @override
  List<double> getFloatUniforms() {
    return [
      _scale,
      _uResolution.x,
      _uResolution.y,
      _metaball1.x,
      _metaball1.y,
      _metaball2.x,
      _metaball2.y,
      _metaball3.x,
      _metaball3.y,
      _metaball4.x,
      _metaball4.y,
      _metaball5.x,
      _metaball5.y,
    ];
  }

  @override
  List<ImageShader> getSamplerUniforms() {
    return [];
  }

  @override
  Future<FragmentProgram> program() {
    return _cachedProgram ??
        FragmentProgram.compile(
          spirv: Uint8List.fromList(base64Decode(_spirv)).buffer,
        );
  }
}

const _spirv =
    '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';
